---
title: "R Notebook"
output: html_notebook
---


```{r message=FALSE}
library(knitr)
library(fpp3)
library(readxl)
library(httr)
library(glue)
```

```{r}
df<-read.csv('df_bike_summons_2023-06-25.csv')

df<-df %>% 
  mutate(VIOLATION_CODE = as.factor(VIOLATION_CODE)) %>%
  mutate(VEH_CATEGORY = as.factor(VEH_CATEGORY)) %>% 
  mutate(CITY_NM = as.factor(CITY_NM)) %>% 
  mutate(RPT_OWNING_CMD = as.factor(RPT_OWNING_CMD)) %>% 
  mutate(VIOLATION_DATE = as.POSIXct(VIOLATION_DATE))
  
head(df)
str(df)


```


# EDA

## General EDA
### What's the Date range for the data?
```{r}
date(range(df$VIOLATION_DATE))

```
### Which dates had the highest number of riders, and how many?
```{r}
df %>% 
  mutate(VIOLATION_DATE = date(VIOLATION_DATE)) %>% 
  arrange(desc(day_total)) %>%
  distinct(VIOLATION_DATE, day_total) %>% 
  slice(1:10)

# takeaway: varied seasons.  Looks like mostly late summer / early autumn.  4 from September 2022.
View(df)
```

### Which dates had the highest number of violations, and how many violations?
```{r}
df %>% 
  mutate(VIOLATION_DATE = date(VIOLATION_DATE)) %>% 
  group_by(VIOLATION_DATE) %>% 
  summarize(daily_total_violations = sum(n())) %>% 
  arrange(desc(daily_total_violations)) %>% 
  slice(1:10)


# mostly warmer days in 2018 and 2019
```






## Daily data EDA

```{r}

# convert to tsibble for ts analysis
ts_daily_total <- df %>% 
  mutate(VIOLATION_DATE = date(VIOLATION_DATE)) %>% 
  group_by(VIOLATION_DATE, day_total) %>% 
  summarize(daily_total_summons = sum(n())) %>% 
  as_tsibble(index = VIOLATION_DATE)

head(ts_daily_total)


```

### plot daily total summonses over time
```{r}

ts_daily_total %>% 
  autoplot(daily_total_summons)

# takeaway:  There were more summonses handed out before the pandemic.  During lockdown, very few were handed out.

```



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

